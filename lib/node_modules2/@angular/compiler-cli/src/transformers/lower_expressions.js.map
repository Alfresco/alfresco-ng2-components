{"version":3,"file":"lower_expressions.js","sourceRoot":"","sources":["../../../../../packages/compiler-cli/src/transformers/lower_expressions.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nimport {createLoweredSymbol, isLoweredSymbol} from '@angular/compiler';\nimport * as ts from 'typescript';\n\nimport {CollectorOptions, MetadataCollector, MetadataValue, ModuleMetadata, isMetadataGlobalReferenceExpression} from '../metadata/index';\n\nexport interface LoweringRequest {\n  kind: ts.SyntaxKind;\n  location: number;\n  end: number;\n  name: string;\n}\n\nexport type RequestLocationMap = Map<number, LoweringRequest>;\n\nconst enum DeclarationOrder { BeforeStmt, AfterStmt }\n\ninterface Declaration {\n  name: string;\n  node: ts.Node;\n  order: DeclarationOrder;\n}\n\ninterface DeclarationInsert {\n  declarations: Declaration[];\n  relativeTo: ts.Node;\n}\n\nfunction toMap<T, K>(items: T[], select: (item: T) => K): Map<K, T> {\n  return new Map(items.map<[K, T]>(i => [select(i), i]));\n}\n\n// We will never lower expressions in a nested lexical scope so avoid entering them.\n// This also avoids a bug in TypeScript 2.3 where the lexical scopes get out of sync\n// when using visitEachChild.\nfunction isLexicalScope(node: ts.Node): boolean {\n  switch (node.kind) {\n    case ts.SyntaxKind.ArrowFunction:\n    case ts.SyntaxKind.FunctionExpression:\n    case ts.SyntaxKind.FunctionDeclaration:\n    case ts.SyntaxKind.ClassExpression:\n    case ts.SyntaxKind.ClassDeclaration:\n    case ts.SyntaxKind.FunctionType:\n    case ts.SyntaxKind.TypeLiteral:\n    case ts.SyntaxKind.ArrayType:\n      return true;\n  }\n  return false;\n}\n\nfunction transformSourceFile(\n    sourceFile: ts.SourceFile, requests: RequestLocationMap,\n    context: ts.TransformationContext): ts.SourceFile {\n  const inserts: DeclarationInsert[] = [];\n\n  // Calculate the range of interesting locations. The transform will only visit nodes in this\n  // range to improve the performance on large files.\n  const locations = Array.from(requests.keys());\n  const min = Math.min(...locations);\n  const max = Math.max(...locations);\n\n  // Visit nodes matching the request and synthetic nodes added by tsickle\n  function shouldVisit(pos: number, end: number): boolean {\n    return (pos <= max && end >= min) || pos == -1;\n  }\n\n  function visitSourceFile(sourceFile: ts.SourceFile): ts.SourceFile {\n    function topLevelStatement(node: ts.Statement): ts.Statement {\n      const declarations: Declaration[] = [];\n\n      function visitNode(node: ts.Node): ts.Node {\n        // Get the original node before tsickle\n        const {pos, end, kind, parent: originalParent} = ts.getOriginalNode(node);\n        const nodeRequest = requests.get(pos);\n        if (nodeRequest && nodeRequest.kind == kind && nodeRequest.end == end) {\n          // This node is requested to be rewritten as a reference to the exported name.\n          if (originalParent && originalParent.kind === ts.SyntaxKind.VariableDeclaration) {\n            // As the value represents the whole initializer of a variable declaration,\n            // just refer to that variable. This e.g. helps to preserve closure comments\n            // at the right place.\n            const varParent = originalParent as ts.VariableDeclaration;\n            if (varParent.name.kind === ts.SyntaxKind.Identifier) {\n              const varName = varParent.name.text;\n              const exportName = nodeRequest.name;\n              declarations.push({\n                name: exportName,\n                node: ts.createIdentifier(varName),\n                order: DeclarationOrder.AfterStmt\n              });\n              return node;\n            }\n          }\n          // Record that the node needs to be moved to an exported variable with the given name\n          const exportName = nodeRequest.name;\n          declarations.push({name: exportName, node, order: DeclarationOrder.BeforeStmt});\n          return ts.createIdentifier(exportName);\n        }\n        let result = node;\n        if (shouldVisit(pos, end) && !isLexicalScope(node)) {\n          result = ts.visitEachChild(node, visitNode, context);\n        }\n        return result;\n      }\n\n      // Get the original node before tsickle\n      const {pos, end} = ts.getOriginalNode(node);\n      let resultStmt: ts.Statement;\n      if (shouldVisit(pos, end)) {\n        resultStmt = ts.visitEachChild(node, visitNode, context);\n      } else {\n        resultStmt = node;\n      }\n\n      if (declarations.length) {\n        inserts.push({relativeTo: resultStmt, declarations});\n      }\n      return resultStmt;\n    }\n\n    let newStatements = sourceFile.statements.map(topLevelStatement);\n\n    if (inserts.length) {\n      // Insert the declarations relative to the rewritten statement that references them.\n      const insertMap = toMap(inserts, i => i.relativeTo);\n      const tmpStatements: ts.Statement[] = [];\n      newStatements.forEach(statement => {\n        const insert = insertMap.get(statement);\n        if (insert) {\n          const before = insert.declarations.filter(d => d.order === DeclarationOrder.BeforeStmt);\n          if (before.length) {\n            tmpStatements.push(createVariableStatementForDeclarations(before));\n          }\n          tmpStatements.push(statement);\n          const after = insert.declarations.filter(d => d.order === DeclarationOrder.AfterStmt);\n          if (after.length) {\n            tmpStatements.push(createVariableStatementForDeclarations(after));\n          }\n        } else {\n          tmpStatements.push(statement);\n        }\n      });\n\n      // Insert an exports clause to export the declarations\n      tmpStatements.push(ts.createExportDeclaration(\n          /* decorators */ undefined,\n          /* modifiers */ undefined,\n          ts.createNamedExports(\n              inserts\n                  .reduce(\n                      (accumulator, insert) => [...accumulator, ...insert.declarations],\n                      [] as Declaration[])\n                  .map(\n                      declaration => ts.createExportSpecifier(\n                          /* propertyName */ undefined, declaration.name)))));\n\n      newStatements = tmpStatements;\n    }\n    // Note: We cannot use ts.updateSourcefile here as\n    // it does not work well with decorators.\n    // See https://github.com/Microsoft/TypeScript/issues/17384\n    const newSf = ts.getMutableClone(sourceFile);\n    if (!(sourceFile.flags & ts.NodeFlags.Synthesized)) {\n      newSf.flags &= ~ts.NodeFlags.Synthesized;\n    }\n    newSf.statements = ts.setTextRange(ts.createNodeArray(newStatements), sourceFile.statements);\n    return newSf;\n  }\n\n  return visitSourceFile(sourceFile);\n}\n\nfunction createVariableStatementForDeclarations(declarations: Declaration[]): ts.VariableStatement {\n  const varDecls = declarations.map(\n      i => ts.createVariableDeclaration(i.name, /* type */ undefined, i.node as ts.Expression));\n  return ts.createVariableStatement(\n      /* modifiers */ undefined, ts.createVariableDeclarationList(varDecls, ts.NodeFlags.Const));\n}\n\nexport function getExpressionLoweringTransformFactory(\n    requestsMap: RequestsMap, program: ts.Program): (context: ts.TransformationContext) =>\n    (sourceFile: ts.SourceFile) => ts.SourceFile {\n  // Return the factory\n  return (context: ts.TransformationContext) => (sourceFile: ts.SourceFile): ts.SourceFile => {\n    // We need to use the original SourceFile for reading metadata, and not the transformed one.\n    const requests = requestsMap.getRequests(program.getSourceFile(sourceFile.fileName));\n    if (requests && requests.size) {\n      return transformSourceFile(sourceFile, requests, context);\n    }\n    return sourceFile;\n  };\n}\n\nexport interface RequestsMap { getRequests(sourceFile: ts.SourceFile): RequestLocationMap; }\n\ninterface MetadataAndLoweringRequests {\n  metadata: ModuleMetadata|undefined;\n  requests: RequestLocationMap;\n}\n\nfunction shouldLower(node: ts.Node | undefined): boolean {\n  if (node) {\n    switch (node.kind) {\n      case ts.SyntaxKind.SourceFile:\n      case ts.SyntaxKind.Decorator:\n        // Lower expressions that are local to the module scope or\n        // in a decorator.\n        return true;\n      case ts.SyntaxKind.ClassDeclaration:\n      case ts.SyntaxKind.InterfaceDeclaration:\n      case ts.SyntaxKind.EnumDeclaration:\n      case ts.SyntaxKind.FunctionDeclaration:\n        // Don't lower expressions in a declaration.\n        return false;\n      case ts.SyntaxKind.VariableDeclaration:\n        // Avoid lowering expressions already in an exported variable declaration\n        return (ts.getCombinedModifierFlags(node) & ts.ModifierFlags.Export) == 0;\n    }\n    return shouldLower(node.parent);\n  }\n  return true;\n}\n\nfunction isPrimitive(value: any): boolean {\n  return Object(value) !== value;\n}\n\nfunction isRewritten(value: any): boolean {\n  return isMetadataGlobalReferenceExpression(value) && isLoweredSymbol(value.name);\n}\n\nfunction isLiteralFieldNamed(node: ts.Node, names: Set<string>): boolean {\n  if (node.parent && node.parent.kind == ts.SyntaxKind.PropertyAssignment) {\n    const property = node.parent as ts.PropertyAssignment;\n    if (property.parent && property.parent.kind == ts.SyntaxKind.ObjectLiteralExpression &&\n        property.name && property.name.kind == ts.SyntaxKind.Identifier) {\n      const propertyName = property.name as ts.Identifier;\n      return names.has(propertyName.text);\n    }\n  }\n  return false;\n}\n\nconst LOWERABLE_FIELD_NAMES = new Set(['useValue', 'useFactory', 'data']);\n\nexport class LowerMetadataCache implements RequestsMap {\n  private collector: MetadataCollector;\n  private metadataCache = new Map<string, MetadataAndLoweringRequests>();\n\n  constructor(options: CollectorOptions, private strict?: boolean) {\n    this.collector = new MetadataCollector(options);\n  }\n\n  getMetadata(sourceFile: ts.SourceFile): ModuleMetadata|undefined {\n    return this.ensureMetadataAndRequests(sourceFile).metadata;\n  }\n\n  getRequests(sourceFile: ts.SourceFile): RequestLocationMap {\n    return this.ensureMetadataAndRequests(sourceFile).requests;\n  }\n\n  private ensureMetadataAndRequests(sourceFile: ts.SourceFile): MetadataAndLoweringRequests {\n    let result = this.metadataCache.get(sourceFile.fileName);\n    if (!result) {\n      result = this.getMetadataAndRequests(sourceFile);\n      this.metadataCache.set(sourceFile.fileName, result);\n    }\n    return result;\n  }\n\n  private getMetadataAndRequests(sourceFile: ts.SourceFile): MetadataAndLoweringRequests {\n    let identNumber = 0;\n    const freshIdent = () => createLoweredSymbol(identNumber++);\n    const requests = new Map<number, LoweringRequest>();\n\n    const isExportedSymbol = (() => {\n      let exportTable: Set<string>;\n      return (node: ts.Node) => {\n        if (node.kind == ts.SyntaxKind.Identifier) {\n          const ident = node as ts.Identifier;\n\n          if (!exportTable) {\n            exportTable = createExportTableFor(sourceFile);\n          }\n          return exportTable.has(ident.text);\n        }\n        return false;\n      };\n    })();\n\n    const isExportedPropertyAccess = (node: ts.Node) => {\n      if (node.kind === ts.SyntaxKind.PropertyAccessExpression) {\n        const pae = node as ts.PropertyAccessExpression;\n        if (isExportedSymbol(pae.expression)) {\n          return true;\n        }\n      }\n      return false;\n    };\n    const replaceNode = (node: ts.Node) => {\n      const name = freshIdent();\n      requests.set(node.pos, {name, kind: node.kind, location: node.pos, end: node.end});\n      return {__symbolic: 'reference', name};\n    };\n\n    const substituteExpression = (value: MetadataValue, node: ts.Node): MetadataValue => {\n      if (!isPrimitive(value) && !isRewritten(value)) {\n        if ((node.kind === ts.SyntaxKind.ArrowFunction ||\n             node.kind === ts.SyntaxKind.FunctionExpression) &&\n            shouldLower(node)) {\n          return replaceNode(node);\n        }\n        if (isLiteralFieldNamed(node, LOWERABLE_FIELD_NAMES) && shouldLower(node) &&\n            !isExportedSymbol(node) && !isExportedPropertyAccess(node)) {\n          return replaceNode(node);\n        }\n      }\n      return value;\n    };\n\n    // Do not validate or lower metadata in a declaration file. Declaration files are requested\n    // when we need to update the version of the metadata to add information that might be missing\n    // in the out-of-date version that can be recovered from the .d.ts file.\n    const declarationFile = sourceFile.isDeclarationFile;\n    const moduleFile = ts.isExternalModule(sourceFile);\n\n    const metadata = this.collector.getMetadata(\n        sourceFile, this.strict && !declarationFile,\n        moduleFile && !declarationFile ? substituteExpression : undefined);\n\n    return {metadata, requests};\n  }\n}\n\nfunction createExportTableFor(sourceFile: ts.SourceFile): Set<string> {\n  const exportTable = new Set<string>();\n  // Lazily collect all the exports from the source file\n  ts.forEachChild(sourceFile, function scan(node) {\n    switch (node.kind) {\n      case ts.SyntaxKind.ClassDeclaration:\n      case ts.SyntaxKind.FunctionDeclaration:\n      case ts.SyntaxKind.InterfaceDeclaration:\n        if ((ts.getCombinedModifierFlags(node) & ts.ModifierFlags.Export) != 0) {\n          const classDeclaration =\n              node as(ts.ClassDeclaration | ts.FunctionDeclaration | ts.InterfaceDeclaration);\n          const name = classDeclaration.name;\n          if (name) exportTable.add(name.text);\n        }\n        break;\n      case ts.SyntaxKind.VariableStatement:\n        const variableStatement = node as ts.VariableStatement;\n        for (const declaration of variableStatement.declarationList.declarations) {\n          scan(declaration);\n        }\n        break;\n      case ts.SyntaxKind.VariableDeclaration:\n        const variableDeclaration = node as ts.VariableDeclaration;\n        if ((ts.getCombinedModifierFlags(node) & ts.ModifierFlags.Export) != 0 &&\n            variableDeclaration.name.kind == ts.SyntaxKind.Identifier) {\n          const name = variableDeclaration.name as ts.Identifier;\n          exportTable.add(name.text);\n        }\n        break;\n      case ts.SyntaxKind.ExportDeclaration:\n        const exportDeclaration = node as ts.ExportDeclaration;\n        const {moduleSpecifier, exportClause} = exportDeclaration;\n        if (!moduleSpecifier && exportClause) {\n          exportClause.elements.forEach(spec => { exportTable.add(spec.name.text); });\n        }\n    }\n  });\n  return exportTable;\n}\n"]}