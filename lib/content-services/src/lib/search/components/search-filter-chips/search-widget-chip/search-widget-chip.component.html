<mat-chip [attr.data-automation-id]="'search-filter-chip-' + category.name"
          disableRipple
          class="adf-search-filter-chip"
          [class.toggle-chip]="(widget.getDisplayValue() | async) || menuTrigger.menuOpen"
          [matMenuTriggerFor]="menu"
          (onMenuOpen)="onMenuOpen()"
          [attr.title]="widget.getDisplayValue() | async"
          #menuTrigger="matMenuTrigger">
    <span class="search-filter-placeholder">
        <span class="search-filter-ellipsis">{{ category.name | translate }}</span>
        <ng-container *ngIf="widget.getDisplayValue() | async">:</ng-container>
    </span>
    <span class="search-filter-value" *ngIf="widget.getDisplayValue() | async as displayValue">
        &nbsp;{{ displayValue | translate }}
    </span>
    <mat-icon>keyboard_arrow_down</mat-icon>
</mat-chip>

<mat-menu #menu="matMenu" backdropClass="adf-search-filter-chip-menu" (closed)="onClosed()">
    <div #menuContainer [attr.data-automation-id]="'search-field-' + category.name">
        <adf-search-filter-menu (click)="$event.stopPropagation()"
                                (keydown.tab)="$event.stopPropagation();"
                                (close)="menuTrigger.closeMenu()">

            <ng-container ngProjectAs="filter-title">
                {{ category.name | translate }} <ng-container *ngIf="category.component.settings.unit">({{category.component.settings.unit}})</ng-container>
            </ng-container>

            <ng-container ngProjectAs="filter-content">
                <adf-search-widget-container #widget
                                             [id]="category.id"
                                             [selector]="category.component.selector"
                                             [settings]="category.component.settings">
                </adf-search-widget-container>
            </ng-container>

            <ng-container ngProjectAs="filter-actions" (click)="menuTrigger.closeMenu()">
                <button mat-flat-button color="accent" (click)="widget.resetInnerWidget()" id="cancel-filter-button">
                    {{ 'SEARCH.FILTER.BUTTONS.REMOVE' | translate }}
                </button>
                <button mat-flat-button color="primary" (click)="widget.applyInnerWidget()" id="apply-filter-button">
                    {{ 'SEARCH.FILTER.BUTTONS.APPLY' | translate }}
                </button>
            </ng-container>
        </adf-search-filter-menu>
    </div>
</mat-menu>
