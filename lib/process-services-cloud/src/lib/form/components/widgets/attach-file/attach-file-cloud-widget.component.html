<div class="adf-attach-widget {{field.className}}" [class.adf-invalid]="!field.isValid"
    [class.adf-readonly]="field.readOnly">
    <label class="adf-label" [attr.for]="field.id">{{field.name}}
        <span *ngIf="isRequired()">*</span>
    </label>
    <div class="adf-attach-widget-container">
        <div class="adf-attach-widget__menu-upload" *ngIf="isUploadButtonVisible()">
            <button (click)="openSelectDialog()" mat-raised-button color="primary" [id]="field.id"
                [matTooltip]="field.tooltip" matTooltipPosition="above" matTooltipShowDelay="1000">
                {{ 'FORM.FIELD.ATTACH' | translate }}
                <mat-icon>{{getWidgetIcon()}}</mat-icon>
            </button>
        </div>
    </div>
</div>

<div id="adf-attach-widget-readonly-list">
    <table mat-table [dataSource]="fileData" class="mat-elevation-z8" *ngIf="hasFile">

        <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef> File Name </th>
            <td mat-cell *matCellDef="let element">
                <mat-icon mat-list-icon class="adf-datatable-selected" *ngIf="selectedNode && element.id === selectedNode.id" (click)="onRowClicked(element)">
                    check_circle
                </mat-icon>
                <img mat-list-icon class="adf-attach-widget__icon" *ngIf="!selectedNode || element.id !== selectedNode.id" [id]="'file-'+element?.id+'-icon'" (click)="onRowClicked(element)"
                        [src]="element.content ? getIcon(element.content.mimeType) : getIcon(element['mimeType'])" [alt]="mimeTypeIcon"
                        role="button" tabindex="0" />
                <span matLine id="{{'file-'+element?.id}}" role="button" tabindex="0" class="adf-file" (click)="onRowClicked(element)">{{element.name}}</span>
            </td>
        </ng-container>

        <ng-container matColumnDef="contentModelPropeties" *ngFor="let columnName of contentModelProps" [matColumnDef]="columnName">
            <th mat-header-cell *matHeaderCellDef>{{ columnName }}</th>
            <td mat-cell *matCellDef="let row">{{ row.properties[columnName] }}</td>
        </ng-container>

        <ng-container matColumnDef="action">
            <th mat-header-cell *matHeaderCellDef> Action </th>
            <td mat-cell *matCellDef="let element">
                <button id="{{'file-'+element?.id+'-option-menu'}}" mat-icon-button [matMenuTriggerFor]="fileActionMenu" *ngIf="!!element.content?.mimeType">
                    <mat-icon>more_vert</mat-icon>
                </button>
                <mat-menu #fileActionMenu="matMenu" xPosition="before">
                    <button *ngIf="displayMenuOption('show') && !!element.content?.mimeType" id="{{'file-'+element?.id+'-show-file'}}"
                            mat-menu-item (click)="onAttachFileClicked(element)">
                        <mat-icon>visibility</mat-icon>
                        <span>{{ 'FORM.FIELD.VIEW_FILE' | translate }}</span>
                    </button>
                    <button *ngIf="displayMenuOption('download') && !!element.content?.mimeType" id="{{'file-'+element?.id+'-download-file'}}"
                            mat-menu-item (click)="downloadContent(element)">
                        <mat-icon>file_download</mat-icon>
                        <span>{{ 'FORM.FIELD.DOWNLOAD_FILE' | translate }}</span>
                    </button>
                    <button *ngIf="displayMenuOption('retrieveMetadata') && !!element.content?.mimeType" id="{{'file-'+element?.id+'-retrieve-file-metadata'}}"
                            mat-menu-item (click)="contentModelFormFileHandler(element)">
                        <mat-icon class="mat-24">low_priority</mat-icon>
                        <span>{{ 'ADF_CLOUD_FORM_COMPONENT.RETRIEVE_METADATA' | translate }}</span>
                    </button>
                    <button *ngIf="!field.readOnly && displayMenuOption('remove')" id="{{'file-'+element?.id+'-remove-file'}}"
                            mat-menu-item [id]="'file-'+element?.id+'-remove'"
                            (click)="onRemoveAttachFile(element);" (keyup.enter)="onRemoveAttachFile(element);">
                        <mat-icon class="mat-24">highlight_off</mat-icon>
                        <span>{{ 'FORM.FIELD.REMOVE_FILE' | translate }}</span>
                    </button>
                </mat-menu>
            </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>

    <div *ngIf="!hasFile && field.readOnly" id="{{'adf-attach-empty-list-'+field.id}}">
        {{ 'FORM.FIELD.NO_FILE_ATTACHED' | translate }}
    </div>
</div>
<error-widget [error]="field.validationSummary"></error-widget>
<error-widget *ngIf="isInvalidFieldRequired()" required="{{ 'FORM.FIELD.REQUIRED' | translate }}"></error-widget>
